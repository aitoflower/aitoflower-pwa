<div class="almacen-container">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <h1>
                <mat-icon>inventory</mat-icon>
                Mi Almacén
            </h1>
            <p class="subtitle">Gestiona tu inventario de productos de cultivo</p>
        </div>
        <button mat-flat-button color="primary" (click)="addItem()" *ngIf="authService.isLoggedIn()">
            <mat-icon>add</mat-icon>
            Añadir Producto
        </button>
    </div>

    <!-- Login Warning for Guests -->
    <div *ngIf="!authService.isLoggedIn()" class="login-warning">
        <mat-icon>info</mat-icon>
        <p>Inicia sesión para gestionar tu almacén personal</p>
        <button mat-flat-button color="primary" (click)="login()">Iniciar Sesión</button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <mat-card class="stat-card stat-card-small">
            <mat-icon class="stat-icon stat-icon-small">eco</mat-icon>
            <div class="stat-content">
                <h3>{{ semillasCount }}</h3>
                <p>Semillas</p>
            </div>
        </mat-card>

        <mat-card class="stat-card stat-card-small">
            <mat-icon class="stat-icon stat-icon-small">potted_plant</mat-icon>
            <div class="stat-content">
                <h3>{{ macetasCount }}</h3>
                <p>Macetas</p>
            </div>
        </mat-card>

        <mat-card class="stat-card stat-card-small">
            <mat-icon class="stat-icon stat-icon-small">layers</mat-icon>
            <div class="stat-content">
                <h3>{{ sustratosCount }}</h3>
                <p>Sustratos</p>
            </div>
        </mat-card>

        <mat-card class="stat-card stat-card-small">
            <mat-icon class="stat-icon stat-icon-small">science</mat-icon>
            <div class="stat-content">
                <h3>{{ nutrientesCount }}</h3>
                <p>Nutrientes</p>
            </div>
        </mat-card>

        <mat-card class="stat-card stat-card-small">
            <mat-icon class="stat-icon stat-icon-small">lightbulb</mat-icon>
            <div class="stat-content">
                <h3>{{ iluminacionCount }}</h3>
                <p>Iluminación</p>
            </div>
        </mat-card>

        <mat-card class="stat-card stat-card-small">
            <mat-icon class="stat-icon stat-icon-small">water_drop</mat-icon>
            <div class="stat-content">
                <h3>{{ riegoCount }}</h3>
                <p>Riego</p>
            </div>
        </mat-card>

        <mat-card class="stat-card stat-card-small">
            <mat-icon class="stat-icon stat-icon-small">air</mat-icon>
            <div class="stat-content">
                <h3>{{ ambienteCount }}</h3>
                <p>Ambiente</p>
            </div>
        </mat-card>

        <mat-card class="stat-card stat-card-small">
            <mat-icon class="stat-icon stat-icon-small">handyman</mat-icon>
            <div class="stat-content">
                <h3>{{ herramientasCount }}</h3>
                <p>Herramientas</p>
            </div>
        </mat-card>

        <mat-card class="stat-card stat-card-large">
            <mat-icon class="stat-icon">inventory_2</mat-icon>
            <div class="stat-content">
                <h3>{{ totalCount }}</h3>
                <p>Total Productos</p>
            </div>
        </mat-card>
    </div>

    <!-- Inventory Table -->
    <mat-card class="inventory-card">
        <mat-card-header>
            <mat-card-title>Inventario</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div *ngIf="!authService.isLoggedIn()" class="restricted-overlay">
                <mat-icon>lock</mat-icon>
                <p>Inicia sesión para ver tu inventario completo</p>
            </div>

            <table mat-table [dataSource]="inventoryItems" class="inventory-table" *ngIf="authService.isLoggedIn()">

                <!-- Name Column -->
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef>Producto</th>
                    <td mat-cell *matCellDef="let item">
                        <div class="product-cell">
                            <mat-icon [class]="'category-icon ' + item.category">{{ getCategoryIcon(item.category)
                                }}</mat-icon>
                            <div>
                                <strong>{{ item.name }}</strong>
                                <small *ngIf="item.notes">{{ item.notes }}</small>
                            </div>
                        </div>
                    </td>
                </ng-container>

                <!-- Category Column -->
                <ng-container matColumnDef="category">
                    <th mat-header-cell *matHeaderCellDef>Categoría</th>
                    <td mat-cell *matCellDef="let item">
                        <mat-chip [class]="'chip-' + item.category">
                            {{ item.category | titlecase }}
                        </mat-chip>
                    </td>
                </ng-container>

                <!-- Brand Column -->
                <ng-container matColumnDef="brand">
                    <th mat-header-cell *matHeaderCellDef>Marca</th>
                    <td mat-cell *matCellDef="let item">{{ item.brand || '-' }}</td>
                </ng-container>

                <!-- Quantity Column -->
                <ng-container matColumnDef="quantity">
                    <th mat-header-cell *matHeaderCellDef>Cantidad</th>
                    <td mat-cell *matCellDef="let item">
                        <span class="quantity-badge">{{ item.quantity }} {{ item.unit }}</span>
                    </td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>Acciones</th>
                    <td mat-cell *matCellDef="let item">
                        <button mat-icon-button (click)="editItem(item)">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button color="warn" (click)="deleteItem(item)">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>

            <div *ngIf="authService.isLoggedIn() && inventoryItems.length === 0" class="empty-state">
                <mat-icon>inventory_2</mat-icon>
                <h3>Almacén vacío</h3>
                <p>Añade tus primeros productos para empezar a gestionar tu inventario</p>
                <button mat-flat-button color="primary" (click)="addItem()">
                    <mat-icon>add</mat-icon>
                    Añadir Producto
                </button>
            </div>
        </mat-card-content>
    </mat-card>
</div>